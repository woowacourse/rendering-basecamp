import Head from "next/head";
import {Header} from "@/components/Header";
import {MovieList} from "@/components/MovieList";
import {Footer} from "@/components/Footer";
import {moviesApi} from "@/api/movies";
import {MovieItem} from "@/types/Movie.types";
import {GetServerSideProps} from "next";

interface HomeProps {
  movies: MovieItem[];
  error: string | null;
}

export const getServerSideProps: GetServerSideProps<HomeProps> = async () => {
  try {
    const response = await moviesApi.getPopular();
    return {
      props: {
        movies: response.data.results,
        error: null
      }
    };
  } catch (error) {
    console.error('영화 데이터 fetch 실패:', error);
    return {
      props: {
        movies: [],
        error: '영화 정보를 불러오는데 실패했습니다.'
      }
    }
  }
}

export default function Home({movies, error}: HomeProps) {
  if (movies.length === 0 || error) {
    return <div>영화 정보를 불러오는데 실패했습니다.</div>;
  }

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="icon" href="/favicon.ico"/>
      </Head>
      <div id="wrap">
        <Header featuredMovie={movies[0]}/>
        <MovieList movies={movies}/>
        <Footer/>
      </div>
    </>
  );
}
